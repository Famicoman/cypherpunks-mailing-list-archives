<!-- MHonArc v2.4.3 -->
<!--X-Subject: Information on key handling with Microsoft products (fwd) -->
<!--X-From-R13: Dnl Oenpuryvna <fhaqreNfhaqrearg.pbz> -->
<!--X-Date: Wed, 28 Jan 1998 02:56:58 +0800 -->
<!--X-Message-Id: Pine.SUN.3.96.980127135417.15074B&#45;100000@beast.brainlink.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Information on key handling with Microsoft products (fwd)</TITLE>
<LINK REV="made" HREF="mailto:sunder@sundernet.com">
</HEAD>
<BODY>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg01247.html">Date Prev</A>][<A HREF="msg01223.html">Date Next</A>][<A HREF="msg01561.html">Thread Prev</A>][<A HREF="msg01223.html">Thread Next</A>][<A HREF="index.html#01222">Date Index</A>][<A HREF="threads.html#01222">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>Information on key handling with Microsoft products (fwd)</H1>
<HR>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<UL>
<LI><em>To</em>: cypherpunks &lt;<A HREF="mailto:cypherpunks@Algebra.COM">cypherpunks@Algebra.COM</A>&gt;, <A HREF="mailto:cypherpunks@cyberpass.net">cypherpunks@cyberpass.net</A>,       <A HREF="mailto:cypherpunks@toad.com">cypherpunks@toad.com</A></LI>
<LI><em>Subject</em>: Information on key handling with Microsoft products (fwd)</LI>
<LI><em>From</em>: Ray Arachelian &lt;<A HREF="mailto:sunder@sundernet.com">sunder@sundernet.com</A>&gt;</LI>
<LI><em>Date</em>: Tue, 27 Jan 1998 13:54:38 -0500 (EST)</LI>
<LI><em>Sender</em>: <A HREF="mailto:owner%2Dcypherpunks@Algebra.COM">owner-cypherpunks@Algebra.COM</A></LI>
</UL>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>


&gt; There's been some discussion recently on this news alias about how
&gt; Microsoft
&gt; handles key management (and some related topics) in CryptoAPI (more
&gt; specifically, the Microsoft base CSPs). Below is a document we've put
&gt; together to help answer these questions.
&gt;
&gt; Thanks,
&gt; -JasonG
&gt;
&gt; Product Manager, Windows NT Security
&gt; Microsoft Corporation
&gt;
&gt;
&gt;
&gt; Microsoft's Response to Recent Questions on the Recovery
&gt; of Private Keys from various Microsoft Products
&gt;
&gt; Recently, there has been discussion on some Internet forums about the
&gt; methods Microsoft uses to store private keys in some of its products, as
&gt; well as about CryptoAPI's role in key management. These discussions
&gt; included
&gt; some inaccurate information about the PFX and PKCS-12 formats, as well as
&gt; how Microsoft implements these formats in its products.
&gt;
&gt; This paper was prepared by the Microsoft Public Key Infrastructure team to
&gt; provide some additional insight and clarification on these issues, and in
&gt; some cases, identify long-term plans that Microsoft has to continue the
&gt; improvement of security in our products.
&gt;
&gt; CryptoAPI
&gt; One area to clarify at the outset is the role of CryptoAPI. Implications
&gt; that any key management problem on Microsoft's Internet products would be
&gt; an
&gt; example of fundamental problems with CryptoAPI are absolutely inaccurate.
&gt; CryptoAPI is a set of cryptographic technologies that are provided for use
&gt; by other software--sort of a cryptographic toolbox. The actual
&gt; cryptographic
&gt; functions are provided through Cryptographic Service Providers (CSPs),
&gt; which
&gt; are implemented as DLLs. With the exception of the details about a
&gt; possible
&gt; PKCS-12 attack, all the issues raised in the recent discussions are
&gt; specifically aimed at Microsoft's base CSPs, not at CryptoAPI.  The base
&gt; CSPs are the royalty-free, software-based CSPs provided with Windows NT
&gt; 4.0,
&gt; Windows 95, and Internet Explorer. These attacks do not apply in general
&gt; to
&gt; other CryptoAPI CSPs and do not indicate any fundamental concerns with the
&gt; security of the CryptoAPI architecture or applications built upon it.
&gt;
&gt; PFX/PKCS-12
&gt; Microsoft products do not "store" private key material using PKCS-12,
&gt; contrary to recent descriptions on the Internet. For clarification,
&gt; PKCS-12
&gt; is a standard format, used for export/import of Public Key Certificates
&gt; and
&gt; related key material.  At present, the only Microsoft product that
&gt; supports
&gt; use of this format is Microsoft Internet Explorer 4.x.  Internet Explorer
&gt; uses PKCS-12 solely as a means of migrating  a user's Certificate and
&gt; public-private key pair between multiple Internet Explorer installations
&gt; or
&gt; between Internet Explorer and other products, such as Netscape
&gt; Communicator.
&gt;
&gt;
&gt; Some background might help. Microsoft originally developed the draft
&gt; specification for an encrypted export/import format, referred to as PFX,
&gt; but
&gt; the PFX specification was never implemented by Microsoft.  Instead, the
&gt; PFX
&gt; specification was handed over to RSA Labs and it became the draft PKCS-12
&gt; specification.  The design was then reviewed, and contributed to, by a
&gt; number of other companies to arrive at the current PKCS-12 standard.
&gt; Microsoft and Netscape have both implemented PKCS-12 with 40-bit
&gt; encryption.
&gt; This was done to provide a common, exportable solution that was completely
&gt; interoperable.
&gt;
&gt; The example of breaking a PKCS-12 data blob, which was given in discussion
&gt; on the Internet, is not an attack on the "weak" cryptography of PKCS-12.
&gt; Rather, it is simply a dictionary attack (long known and well understood
&gt; in
&gt; cryptography), which works well if people use poorly-chosen passwords to
&gt; protect the PKCS-12 data blob. Examples of such bad passwords include
&gt; words
&gt; in the English dictionary.  In our implementation of PKCS-12, we could
&gt; possibly do some things to make brute-force attack against an exported
&gt; PKCS-12 data blob more difficult. For example, performing a dictionary
&gt; check
&gt; on the password before accepting it for encrypting the data blob would
&gt; reduce the use of weak passwords. Alternatively, we could  iterate the
&gt; setup
&gt; function to increase "diversity" making it much more expensive for an
&gt; attacker to search. However, neither of these methods are required for
&gt; protection of the data blob. Good security is always a combination of
&gt; technology and policy. As part of a strong security policy, strong
&gt; passwords
&gt; should be used on all resources. The Microsoft Security Advisor website
&gt; (<A  HREF="http://www.microsoft.com/security">http://www.microsoft.com/security</A>) has some guidelines for choosing
&gt; strong
&gt; passwords.
&gt;
&gt; One statement by the original poster argues that Microsoft managed to
&gt; design
&gt; a security format that actually makes it easier to break into the
&gt; protected
&gt; data. As stated above, a number of well respected companies were involved
&gt; extensively in the design and review of PKCS-12 before it became a
&gt; standard.
&gt; An iteration count, which would make the type of attack described above
&gt; more
&gt; difficult (in terms of time), was added late in the PKCS-12 evolution.  It
&gt; was, however, too late to make it into the Internet Explorer 4 product
&gt; release. Future versions of Internet Explorer will include support for the
&gt; an iteration count, further strengthening the security of exported key
&gt; material.
&gt;
&gt; Of course, in general the PKCS-12 data objects will not be available on a
&gt; user's machine, since they are only used by Internet Explorer 4.x when
&gt; exporting key material to, or importing key material from another system.
&gt; As
&gt; with any sensitive data, users should take care when working PKCS-12 data
&gt; blobs and not leave them on their hard drives.
&gt;
&gt; Exploiting Internet Explorer
&gt; One of the fundamental requirements to perform any possible cryptographic
&gt; attack discussed in the recent postings is the assumption that a malicious
&gt; entity could somehow access to data on a user's computer system, without
&gt; the
&gt; permission or knowledge of the user.  This is a large leap of faith.
&gt; Users
&gt; that are using Public Key Certificates today are generally sophisticated
&gt; and
&gt; savvy users, or part of a larger corporate infrastructure with
&gt; knowledgeable
&gt; administrators. This class of users will certainly keep abreast of current
&gt; security issues and install security-related patches and updates as they
&gt; become available. Microsoft has been extremely responsive in dealing with
&gt; all known Internet Explorer security attacks and has posted patches for
&gt; all
&gt; currently known attacks. And, of course, security issues are certainly not
&gt; limited to Microsoft software.
&gt;
&gt; Information on security-related issues with Microsoft products is
&gt; available
&gt; on the Microsoft Security Advisor website at
&gt; <A  HREF="http://www.microsoft.com/security">http://www.microsoft.com/security</A>.
&gt;
&gt; Attacks against Authenticode signing keys
&gt; Another concern identified was that if a malicious hacker could steal a
&gt; user's or company's Authenticode signing key, that hacker could sign
&gt; objects
&gt; with that key and distribute them. Then when other users tried to download
&gt; the signed object, they would think the key's owner really signed the
&gt; object, which might contain malicious code. The Authenticode program has
&gt; been designed to ensure that only trusted programs are allowed to run on a
&gt; users machine. As stated earlier Microsoft has been very responsive is
&gt; addressing security issues with IE.
&gt;
&gt; However, it is extremely unlikely anyone could be successful with a
&gt; simplistic strategy for stealing Authenticode signing keys and then using
&gt; them.  As noted above, there are security patches already released for
&gt; known
&gt; Internet Explorer bugs that could possibly allow a key blob to be stolen
&gt; off
&gt; a user's hard disk (assuming a user left an Authenticode 'key' file on
&gt; their
&gt; hard disk).   Second, anyone signing code using Authenticode technology is
&gt; extremely unlikely to leave their key material sitting on an end user
&gt; machine routinely used for browsing the Internet.
&gt;
&gt; Microsoft recommends storing key material, such as that used in
&gt; Authenticode, in hardware tokens. Such tokens prevent any of these attacks
&gt; from getting started as the keys are not stored in the PC and are not
&gt; exportable.  The Authenticode signing keys that Microsoft uses for all our
&gt; software, for instance, are stored in such a physical hardware key storage
&gt; mechanism.
&gt;
&gt; Attacks on Encrypted Key material
&gt; There is some confusion over the algorithms and methods that Microsoft
&gt; uses
&gt; to provide protection of encrypted key material in Internet Explorer when
&gt; using the standard Microsoft base CSPs. There were changes between
&gt; Internet
&gt; Explorer 3.0x and Internet Explorer 4.x specifically to address any
&gt; possible
&gt; concern. Note, this concern is unlikely to be valid for any third-party
&gt; software CSP and is not relevant to hardware CSPs.
&gt;
&gt; Microsoft is constantly working to improve the security of our products.
&gt; We
&gt; determined that there were better suited methods for storing keys than
&gt; using
&gt; the RSA RC4 stream cipher algorithm used in Internet Explorer 3.0x.  In
&gt; particular, a stream cipher, such as RC4, is not ideally suited for this
&gt; particular use because it can be susceptible to a "known-keystream
&gt; attack".
&gt; In a known-keystream attack, if you know the plain text, which you
&gt; arguably
&gt; might be able to determine given the number of standard PKCS-8 fields, you
&gt; can recover the keystream.  If you recover the keystream, then a XOR
&gt; function will indeed decrypt anything else encrypted with the same key.
&gt; However, Microsoft only used this RC4-based implementation in the base
&gt; CSPs
&gt; that shipped with Internet Explorer 3.0x.  The CSPs that shipped in
&gt; Internet
&gt; Explorer 4.x protect private key material in a form that is encrypted
&gt; using
&gt; DES, which is a block cipher and is not susceptible to the known-keystream
&gt; attack that can be used against RC4.
&gt;
&gt; Again, note that this kind of attack assumes some degree of security
&gt; breach
&gt; on the user's system such that the keystream could be obtained.
&gt;
&gt; Key export attacks
&gt; The original Internet posting raises concern about the CryptoAPI interface
&gt; CryptExportKey().  This function is fully documented and does indeed
&gt; export
&gt; private key material in an encrypted format.  The presence of the
&gt; CryptExportKey() function is to support functionality such as migrating
&gt; key
&gt; material between machines for a user or creating a backup copy of a key.
&gt; It
&gt; should be noted however, that many CSPs, including most hardware based
&gt; CSPs,
&gt; do not allow exportable private keys and will return and error in response
&gt; to a CryptExportKey() request.
&gt;
&gt; Also, Microsoft's base software CSPs provide a means to mark keys as
&gt; non-exportable when they are generated.  An additional security protection
&gt; is provided if the flag CRYPT_USER_PROTECTED is set, in which case each
&gt; use
&gt; of the private key, including export, requires the user to supply a
&gt; password
&gt; to access the key.  Some commercial CAs are not currently setting this
&gt; flag
&gt; and do not provide the user a way to request it during Certificate
&gt; enrollment.  We recognize this as a problem.  We will continue working
&gt; with
&gt; CAs to assist them in supporting these security features.  However, we
&gt; will
&gt; also make available a utility to allow setting this flag after key
&gt; generation for users concerned with this type of attack.
&gt;
&gt; The posting also asserts that an ActiveX control could be downloaded from
&gt; a
&gt; web page, simply ask for the current users key, ship the key off for
&gt; collection by an unscrupulous person, and then delete itself without a
&gt; trace.
&gt;
&gt; If users run unsigned code, or code from an unknown origin, a number of
&gt; unpleasant things can happen.  This could indeed occur if the key as been
&gt; marked exportable and the CRYPT_USER_PROTECTED flag is not set. However,
&gt; such a scenario assumes that the user follows few or no policies with
&gt; regard
&gt; to good security, such as running code from unknown sources. Similarly, if
&gt; the user were running software from unknown/untrusted sources, that
&gt; software
&gt; could reformat their hard drive, or manipulate other user data. This
&gt; concept
&gt; is certainly not new.
&gt;
&gt; There was also discussion of 16 dialog boxes appearing to the user for
&gt; their
&gt; password if the CRYPT_USER_PROTECTED flag is set. Certainly asking the
&gt; user
&gt; too many times would be better than too few times, however in our tests,
&gt; under extreme (and uncommon cases), a user might be asked for their
&gt; password
&gt; at most four times when a key is used with the Microsoft base CSPs.
&gt; Perhaps
&gt; the claim came from an early beta release.
&gt;
&gt; ----------------------------------------------------------------
&gt; Users Guide <A  HREF="http://www.microsoft.com/sitebuilder/resource/mailfaq.asp">http://www.microsoft.com/sitebuilder/resource/mailfaq.asp</A>
&gt; contains important info including how to unsubscribe.  Save time, search
&gt; the archives at <A  HREF="http://microsoft.ease.lsoft.com/archives/index.html">http://microsoft.ease.lsoft.com/archives/index.html</A>


</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg01247.html">Re: Video &amp; cryptography...</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg01223.html">Sweedish police weed out hackers</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg01561.html">Eureka! Tue Jan 27 '98</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg01223.html">Sweedish police weed out hackers</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#01222"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#01222"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
