<!-- MHonArc v2.4.3 -->
<!--X-Subject: suppressing duplicates based on MD5 of body -->
<!--X-From-R13: Oyna Pneergg <ncoNvnsevpn.pbz> -->
<!--X-Date: Mon, 17 Feb 1997 08:59:07 &#45;0800 (PST) -->
<!--X-Message-Id: 199702171658.SAA03217@apb.iafrica.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>suppressing duplicates based on MD5 of body</TITLE>
<LINK REV="made" HREF="mailto:apb@iafrica.com">
</HEAD>
<BODY>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg01229.html">Date Prev</A>][<A HREF="msg02432.html">Date Next</A>][<A HREF="msg00869.html">Thread Prev</A>][<A HREF="msg00890.html">Thread Next</A>][<A HREF="index.html#02451">Date Index</A>][<A HREF="threads.html#02451">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>suppressing duplicates based on MD5 of body</H1>
<HR>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<UL>
<LI><em>To</em>: <A HREF="mailto:cypherpunks@toad.com">cypherpunks@toad.com</A></LI>
<LI><em>Subject</em>: suppressing duplicates based on MD5 of body</LI>
<LI><em>From</em>: Alan Barrett &lt;<A HREF="mailto:apb@iafrica.com">apb@iafrica.com</A>&gt;</LI>
<LI><em>Date</em>: Mon, 17 Feb 1997 18:58:58 +0200 (GMT+0200)</LI>
<LI><em>Sender</em>: <A HREF="mailto:owner%2Dcypherpunks@toad.com">owner-cypherpunks@toad.com</A></LI>
</UL>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
It's been more than 30 hours since I sent the first copy of this message
to cypherpunks@toad.com, and I still haven't seen it on either the
moderated or the flames lists @toad.com.  Suspecting that a particular
naughty word was to blame, I inserted some hyphens and resent the
message several hours later.  That too has failed to reach me on either
the moderated to the flames lists @toad.com.  I am now kmtkujatwv to
several other flavours of the list, and will be interested to see which
(if any) get *this* message, in which the naughty word is encrypted
using the well-known ROT-n algorithm, with a key that I will keep
secret.

Heres's a procmail recipe for suppressing duplicate messages based on
the MD5 of a "normalised" version of the body of the messages.  Folk who
celcmbslo to more than one of the cypherpunks lists may find it useful.

:0
* (Sender: |Return-Path: |Received:.*for.*)(owner-)?cypherpunks
{

    # Detect duplicate messages based on MD5 of normalised body
    :0:.md5.lock
    * B ?? ? (m=`$HOME/bin/normalise-body | md5`; \
	echo "Message-ID: &lt;$m@MD5&gt;" \
	| formail -D 8192 .body-md5.cypherpunks.cache )
    cypherpunks-duplicates

    :0:
    cypherpunks
}


The "* B ?? ?" means "send the body of the message as input to
the following command, and test the command's exit status".
$HOME/bin/normalise-body is a simple perl script (appended) that deletes
trailing blanks on all lines and then deletes leading and trailing blank
lines.

--apb (Alan Barrett)

# This is a shell archive.  Save it in a file, remove anything before
# this line, and then unpack it by entering "sh file".  Note, it may
# create directories; files and directories will be owned by you and
# have default permissions.
#
# This archive contains:
#
#	normalise-body
#
echo x - normalise-body
sed 's/^X//' &gt;normalise-body &lt;&lt; 'END-of-normalise-body'
X#!/usr/bin/perl
X
X# A very weak attempt at normalising the body of a mail message.
X# Removes trailing white space on all lines, and removes leading
X# and trailing blank lines.
X# Does not attempt to normalise any MIME content-transfer-encoding.
X
X$total_nonblank_lines = 0;
X$consecutive_blank_lines = 0;
Xwhile (&lt;&gt;) {
X    s/\s+$//;
X    if (/^$/) {
X	$consecutive_blank_lines++;
X    } else {
X	print "\n" x $consecutive_blank_lines if $total_nonblank_lines;
X	print $_;
X	$consecutive_blank_lines = 0;
X	$total_nonblank_lines++;
X    }
X}
END-of-normalise-body
exit

</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg01229.html">Another test</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg02432.html">Re: The Offending Stronghold posts...</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00869.html">FC97 lookalike: Stock Trading over the Internet Conference</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00890.html">suppressing duplicates based on MD5 of body</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#02451"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#02451"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
